<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Redirecting...</title>
  <script>
    (function() {
      const path = window.location.pathname;
      const repoName = 'mita-state-self-assessment-tool';
      const redirectKey = 'mita_redirect_path';
      const redirectCount = parseInt(sessionStorage.getItem('mita_redirect_count') || '0');
      
      // For debugging
      console.log('Current path:', path);
      
      // Stop after 3 redirects to prevent infinite loops
      if (redirectCount > 3) {
        document.body.innerHTML = '<p>Too many redirects. Please go to the <a href="/">home page</a>.</p>';
        return;
      }
      
      // Check if we've already tried to redirect this path
      if (sessionStorage.getItem(redirectKey) === path) {
        document.body.innerHTML = '<p>Page not found. Please go to the <a href="/">home page</a>.</p>';
        return;
      }
      
      // Check for exact matches to root paths that should load the index
      if (path === `/${repoName}` || path === `/${repoName}/`) {
        console.log('Main branch root path detected');
        window.location.href = `/${repoName}/index.html`;
        return;
      }
      
      const repoIndex = path.indexOf(repoName);
      if (repoIndex !== -1) {
        const pathAfterRepo = path.substring(repoIndex + repoName.length);
        const segments = pathAfterRepo.split('/').filter(Boolean);
        
        console.log('Path segments after repo:', segments);
        
        // Track this redirect attempt
        sessionStorage.setItem(redirectKey, path);
        sessionStorage.setItem('mita_redirect_count', (redirectCount + 1).toString());
        
        if (segments.length > 0) {
          // Check if this is a branch root path
          if (segments.length === 1 && (pathAfterRepo === `/${segments[0]}` || pathAfterRepo === `/${segments[0]}/`)) {
            console.log('Branch root path detected:', segments[0]);
            window.location.href = `/${repoName}/${segments[0]}/index.html`;
            return;
          }
          
          // Branch deployment - redirect to the branch path
          window.location.href = `/${repoName}/${segments[0]}/`;
        } else {
          // Main deployment
          window.location.href = `/${repoName}/`;
        }
      } else {
        window.location.href = '/';
      }
    })();
  </script>
</head>
<body>
  <p>Redirecting to the application...</p>
</body>
</html>